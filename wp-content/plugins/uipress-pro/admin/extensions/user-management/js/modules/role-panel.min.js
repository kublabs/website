export function moduleData(){return{props:{refreshTable:Function,closePanel:Function},inject:["appData","uipress"],data:function(){return{activeroleName:"",toggleState:!1,translations:this.appData.translations,currentRole:this.$route.params.role,role:{editData:[]},capSeach:"",activeCat:"all",allcaps:this.appData.capabilities,customcap:"",userFecthed:!1,newCap:{name:""}}},mounted:function(){this.setRole()},watch:{"newCap.name":{handler(e,a){if(e&&e.length>0){let a=e;a=(a=(a=a.replace(" ","_")).replace("-","_")).toLowerCase(),this.newCap.name=a}},deep:!0}},computed:{totalAvailableCaps(){return this.allcaps.all.caps.length},totalAssignedCaps(){let e=this.role.editData.caps,a=0;for(var i in e){1==e[i]&&(a+=1)}return a}},methods:{setRole(){let e=this,a=new FormData;a.append("action","uip_get_singular_role"),a.append("security",uip_ajax.security),a.append("role",e.currentRole),e.uipress.callServer(uip_ajax.ajax_url,a).then(a=>{let i=a;i.error?e.uipress.notify(i.message,"","error"):(e.role.editData=i.role,Array.isArray(e.role.editData.caps)&&(e.role.editData.caps={}),e.userFecthed=!0,e.activeroleName=e.role.editData.name)})},updateRole(){let e=this,a=new FormData;a.append("action","uip_update_user_role"),a.append("security",uip_ajax.security),a.append("role",JSON.stringify(e.role.editData)),a.append("originalRoleName",e.activeroleName),e.uipress.callServer(uip_ajax.ajax_url,a).then(a=>{let i=a;i.error?e.uipress.notify(i.message,"","error"):(e.uipress.notify(i.message,"","success"),e.activeroleName=e.role.editData.name)})},deleteRole(){let e=this;if(!confirm(e.appData.translations.confirmRoleDelete))return;let a=new FormData;a.append("action","uip_delete_role"),a.append("security",uip_ajax.security),a.append("role",JSON.stringify(e.role.editData)),e.uipress.callServer(uip_ajax.ajax_url,a).then(a=>{let i=a;i.error?e.uipress.notify(i.message,"","error"):(e.uipress.notify(i.message,"","success"),e.$router.push("/"),e.appData.refreshRoles())})},addCustomCap(){let e=this;e.role.editData.caps[e.newCap.name]=!0;let a=new FormData;a.append("action","uip_add_custom_capability"),a.append("security",uip_ajax.security),a.append("role",JSON.stringify(e.role.editData)),a.append("customcap",e.newCap.name),e.uipress.callServer(uip_ajax.ajax_url,a).then(a=>{let i=a;i.error?e.uipress.notify(i.message,"","error"):(e.uipress.notify(i.message,"","success"),e.newCap.name="",e.allcaps=i.allcaps)})},toggleAllCaps(){let e=this;for(let a of this.allcaps.all.caps)e.role.editData.caps[a]=this.toggleState;this.toggleState=!this.toggleState},isInCaps(e){let a=this.role.editData.caps;return!(!a[e]||1!=a[e])},toggleCap(e){let a=this.role.editData.caps;a[e]&&1==a[e]?this.role.editData.caps[e]=!1:this.role.editData.caps[e]=!0},removeCapability(e){let a=this;if(!confirm(a.appData.translations.confirmCapDelete))return;let i=new FormData;i.append("action","uip_remove_custom_capability"),i.append("security",uip_ajax.security),i.append("role",JSON.stringify(a.role.editData)),i.append("customcap",e),a.uipress.callServer(uip_ajax.ajax_url,i).then(e=>{let i=e;i.error?a.uipress.notify(i.message,"","error"):(a.uipress.notify(i.message,"","success"),a.allcaps=i.allcaps)})},inSearch(e){if(!e||void 0===e)return!0;let a=e.toLowerCase(),i=this.capSeach.toLowerCase();return!!a.includes(i)}},template:'\n      \n      <floating-panel closeRoute="/">\n      \n          \n      \n        <div class="uip-flex uip-flex-grow uip-flex-column uip-max-h-100p">\n      \n          <div class="uip-padding-m uip-border-bottom uip-flex uip-flex-column uip-row-gap-xs" >\n            <div class="uip-text-bold uip-text-xl">{{appData.translations.editRole}}</div>\n          </div>\n          \n          <div v-if="!userFecthed" class="uip-padding-m uip-flex uip-flex-middle uip-flex-center uip-flex-grow">\n            <loading-chart></loading-chart>\n          </div>\n          \n          \x3c!-- EDITING USER --\x3e\n          <div v-else class="uip-padding-m uip-flex-grow uip-border-bottom uip-overflow-auto" >\n          \n            <div class="uip-flex uip-flex-column uip-row-gap-s">\n            \n              <template v-if="role.editData.name == \'administrator\'">\n                <div v-if="role.editData.name == \'administrator\'" class="uip-background-orange-wash uip-padding-xs uip-border-rounder">\n                  {{appData.translations.adminWarning}}\n                </div>\n                \n                <div class="uip-border-top"></div>\n              \n              </template>\n              \n              <div>\n                <div class="uip-text-m uip-text-bold uip-text-emphasis uip-flex-grow">{{appData.translations.details}}</div>\n                \n                <div class="uip-grid-col-1-3 uip-padding-s uip-padding-right-remove">\n                  \x3c!-- Role name --\x3e\n                  <div class="uip-text-muted uip-flex uip-flex-center"><span>{{appData.translations.label}}</span></div>\n                  <input type="text" class="uip-input uip-w-100p" v-model="role.editData.label">\n                  \n                  \x3c!-- Redirect --\x3e\n                  <div class="uip-text-muted uip-flex uip-flex-center"><span>{{appData.translations.loginRedirect}}</span></div>\n                  <input placeholder="index.php" \n                  type="text" class="uip-input uip-w-100p" v-model="role.editData.redirect">\n                </div>\n              </div>\n              \n              <div class="uip-border-top"></div>\n              \n              <div>\n              \n                <div class="uip-flex uip-flex-middle uip-flex-center uip-flex-between uip-border-rounded uip-border-round">\n                    <div class="uip-text-m uip-text-bold uip-text-emphasis uip-flex-grow">{{appData.translations.capabilities}}</div>\n                    <div class="uip-text-muted">{{totalAssignedCaps}} / {{totalAvailableCaps}}</div>\n                </div>\n                \n                \n                <div class="uip-padding-s uip-padding-right-remove uip-flex uip-gap-s">\n                \n                  \x3c!--Categories--\x3e\n                  <div class="uip-w-150 uip-flex uip-flex-column uip-gap-xxs">\n                    <template v-for="cat in allcaps">\n                      <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-padding-xxxs uip-border-round uip-link-muted hover:uip-background-muted" \n                      :class="{\'uip-text-bold uip-text-emphasis\' : activeCat == cat.shortname}" @click="activeCat = cat.shortname">\n                        <div class="uip-icon">{{cat.icon}}</div>\n                        <div class="">{{cat.name}}</div>\n                      </div>\n                    </template>\n                    \n                    \n                    <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-padding-xxxs uip-border-round uip-link-muted uip-margin-top-s" \n                    @click="toggleAllCaps(role)">\n                      <span class="uip-icon">indeterminate_check_box</span>\n                      <span class="uip-line-height-1">{{appData.translations.toggleAll}}</span>\n                    </div>\n                    \n                    \x3c!--New cap--\x3e\n                    <drop-down dropPos="bottom-left">\n                      <template v-slot:trigger>\n                        <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-border-rounder uip-button-default uip-margin-top-s">\n                          <span class="uip-icon">add</span>\n                          <span class="uip-line-height-1">{{appData.translations.addCapability}}</span>\n                        </div>\n                      </template>\n                      <template v-slot:content>\n                          <div class="uip-flex uip-flex-column uip-row-gap-s uip-padding-xs">\n                            \n                            <input :placeholder="appData.translations.addCustomCapability" class="uip-input-small uip-w-100p" type="text" v-model="newCap.name">\n                                                        \n                            <button class="uip-button-primary uip-border-rounder" @click="addCustomCap()">{{appData.translations.addCapability}}</button>\n                          </div>\n                      </template>\n                    </drop-down>\n                    \n                    \n                  </div>\n                  \n                  \n                  \x3c!-- caps --\x3e\n                  <div class="uip-flex-grow uip-padding-xxs uip-flex uip-flex-column uip-row-gap-xxs">\n                  \n                    <div class="hover:uip-background-muted uip-padding-xxs uip-border-round uip-flex uip-flex-center uip-gap-xs uip-margin-bottom-xs">\n                      <span class="uip-icon">search</span>\n                      <input class="uip-blank-input uip-flex-grow uip-text-s" :placeholder="appData.translations.searchCapabilities" v-model="capSeach">\n                    </div>\n                    \n                    <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-max-h-300 uip-overflow-auto uip-padding-right-xxs">\n                      <template v-for="cap in allcaps[activeCat].caps">\n                      \n                        <div v-if="inSearch(cap)" class="uip-flex uip-flex-center uip-gap-s uip-background-muted uip-border-round uip-cursor-pointer uip-padding-xxs">\n                          <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-border-round uip-cursor-pointer uip-flex-grow" @click="toggleCap(cap)">\n                            <div v-if="isInCaps(cap)" class="uip-icon uip-text-accent">radio_button_checked</div>\n                            <div v-if="!isInCaps(cap)" class="uip-icon" >radio_button_unchecked</div>\n                            <div class="uip-flex-grow uip-text-s">{{cap}}</div>\n                          </div>\n                          <div>\n                            <div class="uip-icon uip-link-danger" @click="removeCapability(cap)">delete</div>\n                          </div>\n                        </div>\n                        \n                      </template>\n                    </div>\n                    \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div class="uip-padding-m uip-flex uip-flex-between">\n            <button class="uip-button-danger" @click="deleteRole()">{{appData.translations.deleteRole}}</button>\n            <button class="uip-button-primary" @click="updateRole()">{{appData.translations.saveRole}}</button>\n          </div>\n          \n          \n        </div>\n      \n      \n      </floating-panel>\n      '}};