export function moduleData(){return{props:{data:Object,dataChange:Function},inject:["appData","uipress"],data:function(){return{loading:!0,modData:this.data,tableData:[],tablePage:1,selectAll:!1,queryRunning:!1,tableFilters:{search:"",roles:[],dateCreated:{type:"on",date:""}},tableOptions:{direction:"ASC",sortBy:"username",perPage:20},ui:{rolePanelOpen:!1,activeRole:[],newRoleOpen:!1,cloneRole:{}}}},mounted:function(){this.loading=!1,this.getRoleData(),this.appData.refreshRoles=this.getRoleData},watch:{modData:{handler(e,t){this.dataChange(e)},deep:!0},tableFilters:{handler(e,t){this.getRoleData()},deep:!0},tableOptions:{handler(e,t){this.getRoleData()},deep:!0},selectAll:{handler(e,t){1==e?this.selectAllUsers():this.deSelectAllUsers()}}},computed:{returnTableData(){return this.tableData},totalSelected(){let e=this,t=0;for(var i in e.tableData.roles)e.tableData.roles[i].selected&&1==e.tableData.roles[i].selected&&(t+=1);return t},getTotalSelected(){let e=this,t=[];for(var i in e.tableData.roles)e.tableData.roles[i].selected&&1==e.tableData.roles[i].selected&&t.push(e.tableData.roles[i]);return t}},methods:{selectAllUsers(){let e=this;for(var t in e.tableData.roles)e.tableData.roles[t].selected=!0;e.selectAll=!0},deSelectAllUsers(){let e=this;for(var t in e.tableData.roles)e.tableData.roles[t].selected=!1;e.selectAll=!1},changePage(e){"next"==e&&(this.tablePage+=1),"previous"==e&&(this.tablePage=this.tablePage-1),this.getRoleData()},updateRoles(e){this.tableFilters.roles=e},getRoleData(){let e=this;if(e.queryRunning)return;e.queryRunning=!0;let t=new FormData;t.append("action","uip_get_role_table_data"),t.append("security",uip_ajax.security),t.append("tablePage",e.tablePage),t.append("filters",JSON.stringify(e.tableFilters)),t.append("options",JSON.stringify(e.tableOptions)),e.uipress.callServer(uip_ajax.ajax_url,t).then(t=>{let i=t;if(e.queryRunning=!1,i.error)return void e.uipress.notify(i.message,"","error");let n=[];e.tableData.columns&&e.tableData.columns.length>0&&(n=e.tableData.columns),e.tableData=i.tableData,n.length>0&&(e.tableData.columns=n)})},deleteRole(e){let t=this;if(!confirm(t.data.translations.confirmRoleDelete))return;let i=new FormData;i.append("action","uip_delete_role"),i.append("security",uip_ajax.security),i.append("role",JSON.stringify(e)),t.uipress.callServer(uip_ajax.ajax_url,i).then(e=>{let i=e;i.error?t.uipress.notify(i.message,"","error"):(t.uipress.notify(i.message,"","success"),t.getRoleData())})},bulkDeleteRoles(){let e=this;if(!confirm(e.data.translations.confirmRoleDeleteMultiple))return;let t=e.getTotalSelected,i=new FormData;i.append("action","uip_delete_roles"),i.append("security",uip_ajax.security),i.append("roles",JSON.stringify(t)),e.uipress.callServer(uip_ajax.ajax_url,i).then(t=>{let i=t;if(i.error)e.uipress.notify(i.message,"","error");else{if(e.uipress.notify(i.message,"","success"),i.undeleted.length>0)for(var n in i.undeleted){let t=i.undeleted[n],l=t.role+"<br>"+t.message;e.uipress.notify(l,"","error")}e.getRoleData()}})},openMessenger(e){this.ui.messageRecipient=e,this.ui.messagePanelOpen=!0},cloneRole(e){this.appData.cloneRole=e,this.$router.push("/roles/edit/new")},goTo(e){this.$router.push(e)}},template:'\n      <div class="uip-margin-top-m uip-text-normal">\n      \n      \n          <div class="uip-margin-bottom-s uip-flex uip-gap-s">\n          \n            <drop-down v-if="totalSelected > 0" dropPos="bottom-left">\n              <template v-slot:trigger>\n                <button class="uip-button-primary uip-flex uip-gap-xs uip-flex-center">\n                  <span class="uip-icon">settings</span>\n                  <span>{{totalSelected + \' \' + data.translations.rolesSelected}}</span>\n                </button>\n              </template>\n              <template v-slot:content>\n              \n                <div class="uip-flex uip-flex-column">\n                \n                  <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxs uip-border-bottom">\n                    \n                    <div class="uip-flex uip-gap-xs uip-border-round uip-cursor-pointer hover:uip-background-muted uip-padding-xxs uip-flex-center" @click="deSelectAllUsers()">\n                      <div class="uip-icon">backspace</div>\n                      <div>{{data.translations.clearSelection}}</div>\n                    </div>\n                    \n                  </div>\n                  \n                  <div class="uip-padding-xs">\n                    <div class="uip-flex uip-gap-xs uip-border-round uip-link-danger hover:uip-background-muted uip-padding-xxs uip-flex-center" @click="bulkDeleteRoles()">\n                      <div class="uip-icon">delete</div>\n                      <div>{{data.translations.deleteSelected}}</div>\n                    </div>\n                  </div>\n                  \n                </div>\n                \n              </template>\n            </drop-down>\n          \n            <div class="hover:uip-background-muted uip-padding-xs uip-border-round  uip-flex uip-flex-center uip-gap-xs uip-flex-grow">\n              <span class="uip-icon uip-text-l">search</span>\n              <input class="uip-blank-input uip-flex-grow" :placeholder="data.translations.searchRoles" v-model="tableFilters.search" />\n            </div>\n            \n            <uip-tooltip :message="data.translations.newRole">\n              <router-link to="/roles/edit/new" class="uip-icon uip-link-default uip-no-underline uip-padding-xs hover:uip-background-muted uip-border-round uip-text-l">add_circle</router-link>\n            </uip-tooltip>\n              \n          </div>\n          \n          \n          \n          \n\t  \t    <table class="uip-w-100p uip-border-collapse uip-margin-bottom-s">\n              <thead>\n                  <tr class="uip-border-bottom" >\n                      <th class="uip-text-left uip-w-28 uip-padding-xs uip-padding-top-s uip-padding-bottom-s"><input type="checkbox" class="uip-checkbox" v-model="selectAll"></th>\n                      <template v-for="column in returnTableData.columns">\n                        \n                        <template v-if="column.active">\n                        \n                          \n                          <th  class="uip-text-left uip-text-bold uip-text-muted uip-padding-xs uip-padding-top-s uip-padding-bottom-s uip-text-left" \n                          :class="[{\'uip-hidden-small\' : !column.mobile}, {\'uip-text-right uip-max-w-100\' : column.name == \'users\' || column.name == \'granted\'}]">\n                            {{column.label}}\n                          </th>\n                        \n                        </template>\n                        \n                      </template>\n                      <th></th>\n                  </tr>\n              </thead>\n              <tbody>\n                  <template v-for="role in returnTableData.roles">\n                    <tr class="hover:uip-background-muted uip-cursor-pointer" @dblclick="goTo(\'/roles/edit/\' + role.name)">\n                        <td class="uip-border-bottom uip-w-28 uip-padding-xs"><input class="uip-checkbox" type="checkbox" v-model="role.selected"></td>\n                        <template v-for="column in returnTableData.columns">\n                          <td class="uip-text-left uip-padding-xs uip-border-bottom" v-if="column.active" :class="{\'uip-hidden-small\' : !column.mobile}">\n                            <div v-if="column.name == \'label\'" class="uip-flex uip-flex-center uip-gap-xs uip-text-bold">\n                              <router-link :to="\'/roles/edit/\' + role.name" class="uip-link-emphasis uip-no-underline">{{role[column.name]}}</router-link>\n                            </div>\n                            \n                            \n                            <div v-else-if="column.name == \'users\'" class="uip-flex uip-flex-center uip-gap-xs uip-text-bold uip-flex-right uip-padding-xxs">\n                              \n                              \n                              <div class="uip-flex uip-gap-xxs uip-flex-center">\n                                                  \n                                                  \n                                <div v-if="role[column.name].length > 0" class="uip-flex uip-flex-reverse uip-margin-left-xxs">\n                                  <template v-for="(user,index) in role[column.name]">\n                                    <div class="uip-w-20 uip-ratio-1-1 uip-text-s uip-background-primary-wash uip-border-circle uip-border-match uip-text-capitalize \n                                    uip-text-center uip-line-height-1 uip-text-center uip-flex uip-flex-center uip-flex-middle uip-margin-left--8">\n                                      <uip-tooltip :message="user" :delay="50">\n                                        <span>{{user[0]}}</span>\n                                      </uip-tooltip>\n                                    </div>\n                                  </template>\n                                </div>\n                                \n                                <div v-if="role.usersCount > role.users.length" class="uip-text-muted uip-text-s">+{{role.usersCount - role.users.length}} {{appData.translations.others}}</div>\n                                \n                                <div v-else-if="role.users.length == 0" class="uip-text-muted uip-text-s">{{appData.translations.noUsers}}</div>\n                                \n                                \n                              </div>\n                              \n                              \n                            </div>\n                            \n                            <div v-else-if="column.name == \'granted\'" class="uip-flex uip-flex-center uip-gap-xs uip-text-bold uip-flex-right">\n                              <span class="uip-background-primary-wash uip-border-round uip-padding-left-xxs uip-padding-right-xxs uip-text-bold">{{role[column.name]}}</span>\n                            </div>\n                            \n                            \n                            <div v-else-if="column.name == \'roles\'" class="uip-flex uip-flex-wrap uip-gap-xs uip-row-gap-xxs">\n                              <div v-for="role in role.roles" class="uip-background-primary-wash uip-border-round uip-padding-left-xxs uip-padding-right-xxs uip-text-bold uip-text-s">\n                                {{role}}\n                              </div>\n                            </div>\n                            <div v-else>{{role[column.name]}}</div>\n                          </td>\n                        </template>\n                        <td class="uip-border-bottom">\n                          <div class="uip-flex uip-flex-right">\n                          \n                            \n                            <drop-down dropPos="left">\n                              <template v-slot:trigger>\n                                <div class="uip-icon uip-link-default uip-padding-xs hover:uip-background-grey uip-border-round uip-text-l">more_horiz</div>\n                              </template>\n                              <template v-slot:content>\n                              \n                                <div class="uip-flex uip-flex-column">\n                                  <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxs uip-border-bottom">\n                                  \n                                    <router-link :to="\'/roles/edit/\' + role.name"\n                                     class="uip-flex uip-gap-xs uip-border-round uip-link-default uip-no-underline hover:uip-background-muted uip-padding-xxs uip-flex-center">\n                                      <div class="uip-icon">edit</div>\n                                      <div>{{data.translations.edit}}</div>\n                                    </router-link>\n                                    \n                                    <div class="uip-flex uip-gap-xs uip-border-round uip-link-default uip-no-underline hover:uip-background-muted uip-padding-xxs uip-flex-center" @click="cloneRole(role)">\n                                      <div class="uip-icon">content_copy</div>\n                                      <div>{{data.translations.clone}}</div>\n                                    </div>\n                                    \n                                  </div>\n                                  \n                                  <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxs">\n                                    <div class="uip-flex uip-gap-xs uip-border-round uip-link-danger uip-no-underline hover:uip-background-muted uip-padding-xxs uip-flex-center" @click="deleteRole(role)">\n                                      <div class="uip-icon">delete</div>\n                                      <div>{{data.translations.delete}}</div>\n                                    </div>\n                                  </div>\n                                  \n                                </div>\n                                \n                              </template>\n                            </drop-down>\n                            \n                            \n                            \n                          </div>\n                        </td>\n                    </tr>\n                  </template>\n              </tbody>\n          </table>\n\t    </div>\n      \n      '}};