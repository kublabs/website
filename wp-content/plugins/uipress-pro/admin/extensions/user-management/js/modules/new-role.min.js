export function moduleData(){return{props:{refreshTable:Function,closePanel:Function,resetclone:Function},inject:["appData","uipress"],data:function(){return{role:{editData:{name:"",label:"",redirect:"",caps:{}}},capSeach:"",activeCat:"all",allcaps:this.appData.capabilities,translations:this.appData.translations}},watch:{"role.editData.name":{handler(a,i){if(a&&a.length>0){let i=a;if(!(i=(i=i.replace(" ","_")).replace("-","_")))return;i=i.toLowerCase(),this.role.editData.name=i}},deep:!0}},mounted:function(){this.formatClone()},computed:{totalAvailableCaps(){let a=this.appData.capabilities,i=0;for(var e in a){i+=a[e].caps.length}return i},totalAssignedCaps(){let a=this.role.editData.caps,i=0;for(var e in a){1==a[e]&&(i+=1)}return i}},methods:{formatClone(){void 0!==this.appData.cloneRole&&(this.appData.cloneRole.caps&&(this.role.editData.caps=this.appData.cloneRole.caps),this.appData.cloneRole.name&&(this.role.editData.name=this.appData.cloneRole.name+"_"+this.appData.translations.copy),this.appData.cloneRole.label&&(this.role.editData.label=this.appData.cloneRole.label+" "+this.appData.translations.copy),this.appData.cloneRole.redirect&&(this.role.editData.redirect=this.appData.cloneRole.redirect),this.appData.cloneRole=!1)},saveRole(){let a=this,i=new FormData;i.append("action","uip_create_new_role"),i.append("security",uip_ajax.security),i.append("newrole",JSON.stringify(a.role.editData)),a.uipress.callServer(uip_ajax.ajax_url,i).then(i=>{let e=i;e.error?a.uipress.notify(e.message,"","error"):(a.uipress.notify(e.message,"","success"),a.$router.push("/roles/edit/"+a.role.editData.name),a.appData.refreshRoles())})},isInCaps(a){let i=this.role.editData.caps;return!(!i[a]||1!=i[a])},toggleCap(a){let i=this.role.editData.caps;i[a]&&1==i[a]?this.role.editData.caps[a]=!1:this.role.editData.caps[a]=!0},inSearch(a){if(!a)return!0;let i=a.toLowerCase(),e=this.capSeach.toLowerCase();return!!i.includes(e)}},template:'\n      <floating-panel closeRoute="/">\n      \n          \n      \n        <div class="uip-flex uip-flex-grow uip-flex-column uip-max-h-100p">\n      \n          <div class="uip-padding-m uip-border-bottom uip-flex uip-flex-column uip-row-gap-xs" >\n            <div class="uip-text-bold uip-text-xl">{{appData.translations.newRole}}</div>\n          </div>\n          \n          \n          \x3c!-- EDITING USER --\x3e\n          <div class="uip-padding-m uip-flex-grow uip-border-bottom uip-overflow-auto" >\n            <div class="uip-flex uip-flex-column uip-row-gap-m">\n              <div v-if="role.editData.name == \'administrator\'" class="uip-background-orange-wash uip-padding-xs uip-border-round">\n                {{appData.translations.adminWarning}}\n              </div>\n              \n              <div class="">\n                <div class="uip-margin-bottom-xs">{{appData.translations.name}}</div>\n                <input type="text" class="uip-input uip-w-100p" v-model="role.editData.name">\n              </div>\n              \n              <div class="">\n                <div class="uip-margin-bottom-xs">{{appData.translations.label}}</div>\n                <input type="text" class="uip-input uip-w-100p" v-model="role.editData.label">\n              </div>\n              \n              <div class="">\n                <div class="uip-margin-bottom-xs">{{appData.translations.loginRedirect}}</div>\n                <input placeholder="index.php" \n                type="text" class="uip-input uip-w-100p" v-model="role.editData.redirect">\n              </div>\n              \n              <div>\n                <div class="uip-flex uip-margin-bottom-s uip-flex-middle uip-flex-center uip-flex-between uip-background-muted uip-border-rounded uip-padding-xs uip-border-round">\n                    <div class="uip-text-m uip-text-bold uip-flex-grow">{{appData.translations.capabilities}}</div>\n                    <div class="uip-text-muted">{{totalAssignedCaps}} / {{totalAvailableCaps}}</div>\n                </div>\n                \n                \n                <div class="uip-padding-xs uip-flex uip-gap-s">\n                \n                  \x3c!--Categories--\x3e\n                  <div class="uip-w-150 uip-flex uip-flex-column uip-gap-xxs">\n                    <template v-for="cat in allcaps">\n                      <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-padding-xxxs uip-border-round uip-link-muted hover:uip-background-muted" \n                      :class="{\'uip-text-bold uip-text-emphasis\' : activeCat == cat.shortname}" @click="activeCat = cat.shortname">\n                        <div class="uip-icon">{{cat.icon}}</div>\n                        <div class="">{{cat.name}}</div>\n                      </div>\n                    </template>\n                    \n                    \n                    <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-padding-xxxs uip-border-round uip-link-muted uip-margin-top-s" \n                    @click="toggleAllCaps(role)">\n                      <span class="uip-icon">indeterminate_check_box</span>\n                      <span class="uip-line-height-1">{{appData.translations.toggleAll}}</span>\n                    </div>\n                    \n                    \n                    \n                    \n                  </div>\n                  \n                  \n                  \x3c!-- caps --\x3e\n                  <div class="uip-flex-grow uip-padding-xxs uip-flex uip-flex-column uip-row-gap-xxs">\n                  \n                    <div class="hover:uip-background-muted uip-padding-xxs uip-border-round uip-flex uip-flex-center uip-gap-xs uip-margin-bottom-xs">\n                      <span class="uip-icon">search</span>\n                      <input class="uip-blank-input uip-flex-grow uip-text-s" :placeholder="appData.translations.searchCapabilities" v-model="capSeach">\n                    </div>\n                    \n                    <template v-for="cap in allcaps[activeCat].caps">\n                    \n                      <div v-if="inSearch(cap)" class="uip-flex uip-flex-center uip-gap-s uip-background-muted uip-border-round uip-cursor-pointer uip-padding-xxs">\n                        <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-border-round uip-cursor-pointer uip-flex-grow" @click="toggleCap(cap)">\n                          <div v-if="isInCaps(cap)" class="uip-icon uip-text-accent">radio_button_checked</div>\n                          <div v-if="!isInCaps(cap)" class="uip-icon" >radio_button_unchecked</div>\n                          <div class="uip-flex-grow uip-text-s">{{cap}}</div>\n                        </div>\n                        <div>\n                          <div class="uip-icon uip-link-danger" @click="removeCapability(cap)">delete</div>\n                        </div>\n                      </div>\n                      \n                    </template>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div class="uip-padding-m uip-flex uip-flex-between">\n            <router-link to="/" class="uip-button-default uip-no-underline" @click="deleteRole()">{{appData.translations.cancel}}</router-link>\n            <button class="uip-button-primary" @click="saveRole()">{{appData.translations.saveRole}}</button>\n          </div>\n          \n          \n        </div>\n      \n      \n      </floating-panel>\n      '}};