const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{parent:[String,Number],list:Array,incrementCount:Function},data:function(){return{loading:!1,baseFolders:[],foldersOpen:!0,dragging:!1,allFiles:0,count:0,newFolder:{name:"",color:"rgb(108, 76, 203)"},strings:{newFolder:__("New folder","uipress-pro"),folderName:__("Folder name","uipress-pro"),folderColor:__("Folder colour","uipress-pro"),create:__("Create","uipress-pro"),allItems:__("All items","uipress-pro"),folders:__("Folders","uipress-pro"),removeFromFolder:__("Remove from folder","uipress-pro")}}},watch:{baseFolders:{handler(e,t){"attachment"==this.postTypes[0]&&wp.media?this.mountMediaLibrary():this.mounPostTable()},deep:!0}},inject:["uipress","postTypes","setActiveFolderID","getActiveFolderID","isDragging","setDrag","limitToAuthor","limitToType","filterTableItems"],mounted:function(){let e=this;this.getBaseFolders(!0),"attachment"==this.postTypes[0]&&wp.media?this.mountMediaLibrary():this.mounPostTable(),document.addEventListener("uip_update_folder",t=>{let r=t.detail.folder_id;"uipfalse"!=r&&"false"!=r||e.getBaseFolders()},{once:!1}),document.addEventListener("uip_update_listeners",t=>{"attachment"==e.postTypes[0]&&wp.media?e.mountMediaLibrary():e.mounPostTable()},{once:!1})},computed:{},methods:{mounPostTable(){let e=this,t=document.querySelector(".wp-list-table");t&&(t.addEventListener("dragstart",t=>{let r=[],i=document.querySelectorAll("tbody .check-column input[type=checkbox]:checked");if(i&&i.length>0)i.forEach(e=>{r.push(e.getAttribute("value"))});else{let e=t.target.getAttribute("data-id");if(!e)return;r.push(e)}e.setDrag(!0);let s=t.target.getAttribute("data-folder-id");t.dataTransfer.setData("itemID",JSON.stringify(r)),t.dataTransfer.setData("parentFolder",s),e.createDragImage(t,r)}),t.addEventListener("dragend",t=>{e.setDrag(!1)}))},mountMediaLibrary(){let e=this,t=0,r=0,i=!1;wp.Uploader&&jQuery.extend(wp.Uploader.prototype,{init:function(){this.uploader.bind("FileFiltered",function(e,r){t++}),this.uploader.bind("BeforeUpload",function(s,d){s.settings.multipart_params.uip_folder_id=e.getActiveFolderID(),i||(i=e.uipress.notify(__("Uploading ")+t+" "+__("files"),"","success",!1,!0)),r++}),this.uploader.bind("UploadComplete",function(s,d){let a=e.getActiveFolderID();e.setActiveFolderID();let n=new CustomEvent("uip_update_folder",{detail:{folder_id:a}});document.dispatchEvent(n),e.uipress.destroy_notification(i),i=!1,t=0,r=0})}});let s=document.querySelector(".attachments-browser");s&&(s.addEventListener("dragstart",t=>{let r=[],i=document.querySelectorAll(".attachments-browser .attachments .attachment[aria-checked=true]");if(i&&i.length>0)i.forEach(e=>{r.push(e.getAttribute("data-id"))});else{let e=t.target.getAttribute("data-id");if(!e)return;r.push(e)}e.setDrag(!0);let s=t.target.getAttribute("data-folder-id");t.dataTransfer.setData("itemID",JSON.stringify(r)),t.dataTransfer.setData("parentFolder",s),e.createDragImage(t,r)}),s.addEventListener("dragend",t=>{e.setDrag(!1)}))},createDragImage(e,t){let r=t.length+" "+__("item","uipress-pro");t.length>1&&(r=t.length+" "+__("items","uipress-pro"));var i=document.createElement("div");i.id="uip-content-drag",i.innerHTML=r,i.style.position="absolute",i.style.top="-1000px",document.body.appendChild(i),e.dataTransfer.setDragImage(i,0,0)},getBaseFolders(e){let t=this;if(t.loading)return;e&&(t.loading=!0);let r=new FormData;r.append("action","uip_folders_get_base_folders"),r.append("security",uip_ajax.security),r.append("limitToAuthor",t.limitToAuthor),r.append("postTypes",JSON.stringify(this.postTypes)),r.append("limitToType",t.limitToType),t.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{t.loading=!1,e.error&&t.uipress.notify(e.message,"","error",!0),e.success&&(t.baseFolders=e.baseFolders,t.allFiles=e.total)})},updateItemFolder(e){let t=this,r=new FormData;r.append("action","uip_folders_update_item_folder"),r.append("security",uip_ajax.security),r.append("item",JSON.stringify(e)),r.append("newParent","uipfalse"),t.uipress.callServer(uip_ajax.ajax_url,r).then(r=>{r.error&&t.uipress.notify(r.message,"","error",!0),r.success&&(e.parent="uipfalse")})},itemAdded(e){let t=this;if(e.added){if("uip-ui-folder"!==e.added.element.type&&(this.baseFolders.splice(e.added.newIndex,1),this.uipress.notify(__("Item removed from folder","uipress-pro"),"","error")),this.baseFolders.filter(t=>t.id===e.added.element.id).length>1)return void this.baseFolders.splice(e.added.newIndex,1);this.baseFolders.sort(function(e,t){let r=e.title.toUpperCase(),i=t.title.toUpperCase();return r<i?-1:r>i?1:0}),t.updateItemFolder(e.added.element)}},removeFilters(){this.setActiveFolderID("all")},addDropClass(e,t){e.preventDefault(),e.target.closest(".uip-remove-drop").classList.add("uip-border-dashed-emphasis"),this.counter++},removeDropClass(e,t){if(e.preventDefault(),this.counter--,0===this.counter){e.target.closest(".uip-remove-drop").classList.remove("uip-border-dashed-emphasis")}},addToFolder(e,t){let r=this;e.target.closest(".uip-remove-drop").classList.remove("uip-border-dashed-emphasis"),r.counter=0;let i=e.dataTransfer.getData("itemID");if(!i)return;if((i=JSON.parse(i)).length<1)return;let s=e.dataTransfer.getData("parentFolder"),d=new FormData;d.append("action","uip_folders_add_item_to_folder"),d.append("security",uip_ajax.security),d.append("IDS",JSON.stringify(i)),d.append("newParent","uipfalse"),d.append("parentFolder",s),d.append("postTypes",JSON.stringify(this.postTypes)),d.append("limitToType",r.limitToType),r.uipress.callServer(uip_ajax.ajax_url,d).then(e=>{if(e.error&&r.uipress.notify(e.message,"","error",!0),e.success&&(r.uipress.notify(__("Item removed from folder","uipress-pro"),"","success",!0),e.folder&&r.baseFolders.push(e.folder),s)){let e=new CustomEvent("uip_update_folder",{detail:{folder_id:s}});document.dispatchEvent(e)}})},deleteFromList(e){let t=this.baseFolders.findIndex(t=>t.id===e);this.baseFolders.splice(t,1)}},template:'\n\t\t\x3c!-- Loop through top level folders --\x3e\n    <div class="uip-max-w-100p uip-padding-s uip-background-default uip-border-rounder uip-flex uip-flex-column uip-row-gap-xs uip-transition-all" \n    :class="{\'uip-padding-remove uip-border\' : !foldersOpen}">\n    \n      <component v-if="foldersOpen" is="style">\n        .wrap:not(#wp-media-grid){padding-left:348px !important;}\n      </component>\n      <component v-else is="style">\n        .wrap:not(#wp-media-grid){padding-left:60px !important;}\n      </component>\n    \n      <div @click="foldersOpen = !foldersOpen"\n      :class="{\'uip-background-default\' : !foldersOpen, \'uip-background-muted\' : foldersOpen}"\n      class="uip-padding-xs uip-border-rounder uip-flex uip-flex-between uip-flex-center uip-gap-xxs hover:uip-background-grey uip-cursor-pointer uip-text-normal">\n      \n        <div v-if="foldersOpen" class="uip-icon uip-text-l">chevron_left</div>\n        <div v-if="foldersOpen" class="uip-flex-grow">{{strings.folders}}</div>\n        \n        <div v-if="!foldersOpen" class="uip-icon uip-text-l">folder</div>\n      </div>\n      \n      <template v-if="foldersOpen">\n      \n        <div @click="removeFilters()" class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-default uip-padding-xxs uip-padding-top-xxxs uip-padding-bottom-xxxs hover:uip-background-muted uip-border-rounder uip-no-text-select uip-margin-top-xs"  :class="{\'uip-background-muted\' : getActiveFolderID() == \'all\'}">\n          <div class="uip-icon uip-text-l">apps</div>\n          <div class="uip-flex-grow">{{strings.allItems}}</div>\n          <div class="uip-text-muted">{{allFiles}}</div>\n          <div class="uip-position-relative uip-opacity-0">\n            <div class="uip-flex">\n                <div class="uip-icon uip-padding-xxxs uip-text-l hover:uip-background-muted uip-link-muted uip-border-rounder">more_vert</div>\n            </div>\n          </div>\n        </div>\n      \n      \n      \n        <div class="uip-padding-xs uip-flex uip-flex-middle uip-flex-center" v-if="foldersOpen && loading"><loading-chart></loading-chart></div>\n          \n        <div class="uip-flex uip-flex-column uip-max-w-100p uip-w-300 uip-row-gap-xxxs">\n          <template v-for="(folder, index) in baseFolders"  :key="folder.id">\n          \n            <content-folder :folder="folder" :removeSelf="function(id){deleteFromList(id)}"></content-folder>\n          \n          </template>\n        </div>\n        \n        \x3c!--Remove from folder--\x3e\n        <div \n        @drop="addToFolder($event, folder)" \n        @dragenter="addDropClass($event, folder)"\n        @dragleave="removeDropClass($event, folder)"\n        @dragover.prevent\n        @dragenter.prevent\n        v-if="isDragging()" class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-default uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-text-select uip-margin-top-xs  uip-background-muted uip-remove-drop">\n          <div class="uip-flex-grow uip-text-muted">{{strings.removeFromFolder}}</div>\n        </div>\n        \n        \x3c!--FOOTER--\x3e\n        <div class="uip-margin-top-xs">\n          <new-folder :list="baseFolders" parent="uipfalse"></new-folder>\n        </div>\n        \n      \n      </template>\n      \n    </div>\n\t\t'}};