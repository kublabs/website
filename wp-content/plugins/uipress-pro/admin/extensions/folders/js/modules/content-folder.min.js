const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{name:"content-folder",props:{folder:Object,removeSelf:Function,updateID:Function},data:function(){return{loading:!1,defaults:[],counter:0,newFolder:{name:"",color:"rgb(108, 76, 203)"},strings:{placeholder:__("Input placeholder...","uipress-pro"),new:__("New","uipress-pro"),loadMore:__("Load more","uipress-pro"),search:__("Search","uipress-pro"),view:__("View","uipress-pro"),edit:__("Edit","uipress-pro"),delete:__("Delete","uipress-pro"),folders:__("Folders","uipress-pro"),duplicate:__("Duplicate","uipress-pro"),folderName:__("Folder name","uipress-pro"),folderColor:__("Folder colour","uipress-pro"),update:__("Update","uipress-pro"),edit:__("Edit","uipress-pro")}}},watch:{},inject:["uipress","postTypes","setActiveFolderID","getActiveFolderID","isDragging","setDrag","limitToAuthor","limitToType","filterTableItems"],mounted:function(){this.mountDragOnFiles()},computed:{},methods:{mountDragOnFiles(){let e=this;document.addEventListener("uip_update_folder",t=>{let r=t.detail.folder_id;e.folder.id==r&&e.getFolderContent()},{once:!1})},getFolderContent(e){let t=this;"page"in t.folder||(t.folder.page=1),e&&(t.folder.loading=!0),t.setActiveFolderID(t.folder.id),wp.media||this.filterTableItems(t.folder.id);let r=new FormData;r.append("action","uip_folders_get_folder_content"),r.append("security",uip_ajax.security),r.append("limitToAuthor",t.limitToAuthor),r.append("postTypes",JSON.stringify(t.postTypes)),r.append("id",t.folder.id),r.append("limitToType",t.limitToType),t.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{t.folder.loading=!1,e.error&&t.uipress.notify(e.message,"","error",!0),e.success&&(t.folder.totalFound=e.totalFound,t.folder.count=e.folderCount,t.folder.content=e.content)})},updateItemFolder(e){let t=this,r=new FormData;r.append("action","uip_folders_update_item_folder"),r.append("security",uip_ajax.security),r.append("item",JSON.stringify(e)),r.append("newParent",t.folder.id),t.uipress.callServer(uip_ajax.ajax_url,r).then(r=>{t.folder.loading=!1,r.error&&t.uipress.notify(r.message,"","error",!0),r.success&&(e.parent=t.folder.id)})},deleteFolder(){let e=this,t=new FormData;t.append("action","uip_folders_delete_folder"),t.append("security",uip_ajax.security),t.append("postTypes",JSON.stringify(e.postTypes)),t.append("folderId",e.folder.id),e.uipress.callServer(uip_ajax.ajax_url,t).then(t=>{e.folder.loading=!1,t.error&&e.uipress.notify(t.message,"","error",!0),t.success&&(e.removeSelf(e.folder.id),e.uipress.notify(__("Folder deleted","uipress-pro"),"","success",!0))})},updateFolder(){let e=this,t=new FormData;t.append("action","uip_folders_update_folder"),t.append("security",uip_ajax.security),t.append("folderId",e.folder.id),t.append("title",e.folder.title),t.append("color",e.folder.color),e.uipress.callServer(uip_ajax.ajax_url,t).then(t=>{t.error&&e.uipress.notify(t.message,"","error",!0),t.success&&(e.uipress.notify(__("Folder updated","uipress-pro"),"","success",!0),e.folder.showEdit=!1)})},itemAdded(e){let t=this;if(e.added){if(this.folder.content.filter(t=>t.id===e.added.element.id).length>1)return void this.folder.content.splice(e.added.newIndex,1);this.folder.content.sort(function(e,t){let r=e.title.toUpperCase(),i=t.title.toUpperCase();return r<i?-1:r>i?1:0}),t.folder.count+=1,t.updateItemFolder(e.added.element)}e.removed&&(t.folder.count-=1,t.folder.totalFound-=1)},setDragAreaClasses(){let e=[];return e.class="uip-flex uip-flex-column uip-row-gap-xxs uip-max-w-100p",e},setBaseFolderClass(){let e=[];return e.class="uip-flex uip-flex-column uip-max-w-100p",e},loadMore(e){e.page+=1,this.getFolderContent()},checkForBlank(e){""==e.search&&(e.page=1,this.getFolderContent(!0))},addDropClass(e,t){e.preventDefault();let r=e.target.closest(".uip-folder-drop");r.classList.add("uip-border-dashed-emphasis"),r.classList.add("uip-background-grey"),this.counter++},removeDropClass(e,t){if(e.preventDefault(),this.counter--,0===this.counter){let t=e.target.closest(".uip-folder-drop");t.classList.remove("uip-border-dashed-emphasis"),t.classList.remove("uip-background-grey")}},finishDrag(e){e.preventDefault();let t=e.target.closest(".uip-folder-drop");t.classList.remove("uip-border-dashed-emphasis"),t.classList.remove("uip-background-grey"),this.setDrag(!1)},setFolderDataTransfer(e){e.dataTransfer.setData("itemID",JSON.stringify([this.folder.id])),e.dataTransfer.setData("parentFolder",this.folder.parent),this.setDrag(!0)},addToFolder(e,t){let r=this;r.finishDrag(e);let i=e.dataTransfer.getData("itemID");if(!i)return;if((i=JSON.parse(i)).length<1)return;let o=e.dataTransfer.getData("parentFolder");r.folder.count+=i.length;let d=new FormData;d.append("action","uip_folders_add_item_to_folder"),d.append("security",uip_ajax.security),d.append("IDS",JSON.stringify(i)),d.append("newParent",r.folder.id),d.append("parentFolder",o),d.append("postTypes",JSON.stringify(r.postTypes)),d.append("limitToType",r.limitToType),r.uipress.callServer(uip_ajax.ajax_url,d).then(e=>{if(r.folder.loading=!1,e.error&&r.uipress.notify(e.message,"","error",!0),e.success&&(r.uipress.notify(e.message,"","success",!0),r.folder.open&&r.getFolderContent(),o)){let e=new CustomEvent("uip_update_folder",{detail:{folder_id:o}});document.dispatchEvent(e)}})},deleteFromList(e){let t=this.folder.content.findIndex(t=>t.id===e);this.folder.content.splice(t,1)}},template:'\n      \n      <div :data-id="folder.id" :data-parent-folder="folder.parent" class="uip-folder" \n      >\n    \n    \n        \x3c!-- top folder --\x3e\n        <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-max-w-100p">\n        \n          <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-default uip-padding-xxs uip-padding-top-xxxs uip-padding-bottom-xxxs hover:uip-background-muted uip-border-round uip-no-text-select uip-folder-drop" \n          :class="[{\'uip-background-muted\' : getActiveFolderID() == folder.id}]"\n          :data-id="folder.id"\n          \n          @drop="addToFolder($event, folder)" \n          @dragenter="addDropClass($event, folder)"\n          @dragleave="removeDropClass($event, folder)"\n          @dragover.prevent\n          @dragenter.prevent\n          \n          @dragstart="setFolderDataTransfer($event)"\n          @dragend="setDrag(false)" \n          draggable="true"\n          >\n          \n          \n          \n            <div class="uip-icon uip-text-l" v-if="!folder.open" :style="\'color:\' + folder.color" @click="folder.open = !folder.open;getFolderContent(true)">folder</div>\n            <div class="uip-icon uip-text-l" v-if="folder.open" :style="\'color:\' + folder.color" @click="folder.open = !folder.open;getFolderContent(true)">folder_open</div>\n            <div class="uip-flex-grow" @click="folder.open = !folder.open;getFolderContent(true)">{{folder.title}}</div>\n            <div class="uip-text-muted">{{folder.count}}</div>\n            <drop-down dropPos="right">\n              <template v-slot:trigger>\n                <div class="uip-icon uip-padding-xxxs uip-text-l hover:uip-background-muted uip-link-muted uip-border-round">more_vert</div>\n              </template>\n              <template v-slot:content>\n                \n                <div class="uip-flex uip-flex-column uip-w-200 uip-max-w-200">\n                \n                  \n                  \x3c!-- Update folders --\x3e\n                  <div class="uip-padding-xs uip-border-bottom uip-flex uip-flex-column uip-gap-xxs" v-if="folder.showEdit">\n                  \n                    <div class="uip-text-muted">{{strings.folderName}}</div>\n                    <input type="text" v-model="folder.title" class="uip-text-s uip-input-small">\n                    \n                    <div class="uip-text-muted uip-margin-top-xs">{{strings.folderColor}}</div>\n                    <div class="uip-background-muted uip-border-round uip-overflow-hidden uip-padding-xxs">\n                      <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center">\n                        <color-picker :value="folder.color" :returnData="function(data){ folder.color = data}">\n                          <template v-slot:trigger>\n                            <div class="uip-border-round uip-w-18 uip-ratio-1-1 uip-border" :style="\'background-color:\' + folder.color"></div>\n                          </template>\n                        </color-picker>\n                        <input v-model="folder.color" type="text" class="uip-blank-input uip-text-s" style="line-height: 1.2em !important">\n                      </div>\n                    </div>\n                    \n                    <button class="uip-button-primary uip-text-s uip-margin-top-s" @click="updateFolder()">{{strings.update}}</button>\n                  \n                  </div>\n                  \n                  <div class="uip-padding-xs uip-border-bottom uip-flex uip-flex-column uip-gap-xxs uip-flex-start">\n                    <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-muted" @click="folder.showEdit = !folder.showEdit">\n                      <div class="uip-icon uip-text-l">edit</div>\n                      <div class="">{{strings.edit}}</div>\n                    </div>\n                  </div>\n                  \n                  <div v-if="folder.canDelete"  class="uip-padding-xs uip-border-bottom uip-flex uip-flex-column uip-gap-xxxs uip-flex-start">\n                    <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-danger" @click="deleteFolder()">\n                      <div class="uip-icon uip-text-l">delete</div>\n                      <div class="">{{strings.delete}}</div>\n                    </div>\n                  </div>\n                  \n                </div>\n                \n              </template>\n            </drop-down>\n            \n            \n            \n            \n          </div>\n          \n        </div> \n        \n        \x3c!-- Folder contents --\x3e\n        \n        <div v-if="folder.open" class="uip-max-w-100p uip-scale-in-top-center">\n          \n          <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-max-w-100p uip-padding-xxxs uip-margin-bottom-xs uip-margin-left-xs uip-padding-left-xs uip-padding-bottom-remove uip-before-border">\n            \n            \x3c!--HEADER--\x3e\n            <div class="uip-margin-top-xs uip-margin-bottom-xs uip-text-s">\n              <new-folder :list="folder.content" :incrementCount="function(e){folder.count += e}" :parent="folder.id"></new-folder>\n            </div>\n            \n            <div class="uip-padding-xs uip-flex uip-flex-middle uip-flex-center" v-if="folder.loading"><loading-chart></loading-chart></div>\n              \n            <div class="uip-flex uip-flex-column uip-max-w-100p uip-row-gap-xxx">\n              <template v-for="(folder, index) in folder.content"  :key="folder.id">\n              \n                <content-folder :folder="folder" :removeSelf="function(id){deleteFromList(id)}"></content-folder>\n              \n              </template>\n            </div>\n            \n              \n          </div>\n          \n        </div>\n        \x3c!--End folder contents --\x3e\n        \n      </div>\n      \n      \n      \n      '}};